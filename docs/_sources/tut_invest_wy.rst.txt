*************************************************
1.1 Getting Data for Assessing Ecosystem Services
*************************************************

You have learned about different ecosystem assessment tools available in
InVEST. We will now go in depth with water yield to assess the
hydropower production from reservoirs service.

Hydropower accounts for 20% of worldwide energy production, most of
which is generated by reservoir systems. InVEST estimates the annual
average quantity and value of hydropower produced by reservoirs and
identifies how much water yield or value each part of the landscape
contributes annually to hydropower production.

The model has three components: water yield, water consumption, and
hydropower valuation. The first two components use data on average
annual precipitation, annual reference evapotranspiration and a
correction factor for vegetation type, root restricting layer depth,
plant available water content, land use and land cover, root depth,
elevation, saturated hydraulic conductivity, and consumptive water use.
The valuation model uses data on hydropower market value and production
costs, the remaining lifetime of the reservoir, and a discount rate.

Upon completion of this exercise, participants should be able to:

-  Install InVEST package and choose a specific ecosystem services model

-  Identify the input data needed to run the InVEST model: Water Yield

-  Define a specific location for a case study

-  Find this data on the Internet and download it

1.1.1 Install InVEST and choose your model 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

First, we search for the InVEST model on the NatCap website at :
http://www.naturalcapitalproject.org/invest

Once identified, you can download the latest version of the package
**without** the tutorial data. The InVEST package is a standalone
software that will run on Windows or Mac operating systems.

1.1.2 Identify the geospatial data inputs
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

As described in the InVEST User manual under the Water Yield model the
data needed for this model
(http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html)
is presented below:

1. **Precipitation (required).** A geographic information System (GIS)
   raster dataset with a non-zero value for average annual precipitation
   for each cell. The precipitation values should be in millimeters.

2. **Average Annual Reference Evapotranspiration (required).** A GIS
   raster dataset, with an annual average evapotranspiration value for
   each cell. Reference evapotranspiration is the potential loss of
   water from soil by both evaporation from the soil and transpiration
   by healthy alfalfa (or grass) if sufficient water is available. The
   reference evapotranspiration values should be in millimeters.

3. **Root restricting layer depth (required).** A GIS raster dataset
   with an average root restricting layer depth value for each cell.
   Root restricting layer depth is the soil depth at which root
   penetration is strongly inhibited because of physical or chemical
   characteristics. The root restricting layer depth values should be in
   millimeters.

4. **Plant Available Water Content (required).** A GIS raster dataset
   with a plant available water content value for each cell. Plant
   Available Water Content fraction (PAWC) is the fraction of water that
   can be stored in the soil profile that is available for plants’ use.
   PAWC is a fraction from 0 to 1.

5. **Land use/land cover (required).** A GIS raster dataset, with an
   LULC code for each cell. The LULC code should be an integer.

6. **Watersheds (required).** A shapefile, with one polygon per
   watershed. This is a layer of watersheds such that each watershed
   contributes to a point of interest where hydropower production will
   be analyzed.

7. **Subwatersheds (required).** A shapefile, with one polygon per
   subwatershed within the main watersheds specified in the Watersheds
   shapefile.

| The standard GIS raster file formats should be used (e.g., ESRI GRID,
  TIF or IMG) or vector formats (ESRI shapefiles). The necessary GIS
  files can be named anything, but no spaces in the name and less than
  13 characters if an ESRI GRID. If a TIF or IMG, the name may be
  longer. We will learn how to pre-process this data in the next
  exercise (part 6.3). More details on the data needed for the Water
  Yield model can be found at:
| http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/reservoirhydropowerproduction.html#data-needs

Once you have downloaded the required files you will have to pre-process
them in the open source QGIS software in the next exercise. Each dataset
must be in the right format with the correct spatial extent and the same
geographic projection.

1.1.3 Area of Interest
~~~~~~~~~~~~~~~~~~~~~~

Choose a location where you would like to assess water yield with
InVEST. We have chosen our hometown of Geneva in Switzerland.

We first need to find the geographic coordinates for the extent of the
area of interest (AOI). We suggest using Google Map for this with
http://maps.google.com, and clicking on the lower left and upper right
corners of your AOI, and then writing down the coordinates.

|image01|

Figure 0.1: Google Map view of Geneva, Switzerland

In the case of Geneva it could be:

Lower left corner: 46.109818 N, 5.940873 E

Upper right corner: 46.444043 N, 6.421520 E

These coordinates will be useful to select our input data in the next
steps and to clip the data to the useful extent if needed.

1.1.4 Precipitation
~~~~~~~~~~~~~~~~~~~

Global annual precipitation data can be obtained from the WorldClim
dataset at 1km resolution:
`http://www.worldclim.org/ <http://worldclim.org/>`__ (Fick & Hijmans,
2017). For Geneva we selected the tile 16 and downloaded Precipitation
in Geotiff format.

|image02|

Figure 0.2: Map of WorldClim tile grid of global precipitation
data

Alternatively select your tile from the following table:

+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|XX|X0                                                                                      |X1                                                                                      |X2                                                                                      |X3                                                                                      |X4                                                                                      |X5                                                                                      |X6                                                                                      |X7                                                                                      |X8                                                                                      |X9                                                                                      |X10                                                                                       |X11                                                                                       |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|0X|`00 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_00_tif.zip>`__ |`01 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_01_tif.zip>`__ |`02 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_02_tif.zip>`__ |`03 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_03_tif.zip>`__ |`04 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_04_tif.zip>`__ |`05 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_05_tif.zip>`__ |`06 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_06_tif.zip>`__ |`07 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_07_tif.zip>`__ |`08 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_08_tif.zip>`__ |`09 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_09_tif.zip>`__ |`010 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_010_tif.zip>`__ |`011 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_011_tif.zip>`__ |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|1X|`10 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_10_tif.zip>`__ |`11 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_11_tif.zip>`__ |`12 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_12_tif.zip>`__ |`13 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_13_tif.zip>`__ |`14 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_14_tif.zip>`__ |`15 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_15_tif.zip>`__ |`16 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_16_tif.zip>`__ |`17 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_17_tif.zip>`__ |`18 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_18_tif.zip>`__ |`19 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_19_tif.zip>`__ |`110 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_110_tif.zip>`__ |`111 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_111_tif.zip>`__ |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|2X|`20 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_20_tif.zip>`__ |`21 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_21_tif.zip>`__ |`22 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_22_tif.zip>`__ |`23 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_23_tif.zip>`__ |`24 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_24_tif.zip>`__ |`25 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_25_tif.zip>`__ |`26 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_26_tif.zip>`__ |`27 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_27_tif.zip>`__ |`28 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_28_tif.zip>`__ |`29 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_29_tif.zip>`__ |`210 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_210_tif.zip>`__ |`211 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_211_tif.zip>`__ |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|3X|`30 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_30_tif.zip>`__ |`31 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_31_tif.zip>`__ |`32 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_32_tif.zip>`__ |`33 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_33_tif.zip>`__ |`34 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_34_tif.zip>`__ |`35 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_35_tif.zip>`__ |`36 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_36_tif.zip>`__ |`37 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_37_tif.zip>`__ |`38 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_38_tif.zip>`__ |`39 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_39_tif.zip>`__ |`310 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_310_tif.zip>`__ |`311 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_311_tif.zip>`__ |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+
|4X|`40 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_40_tif.zip>`__ |`41 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_41_tif.zip>`__ |`42 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_42_tif.zip>`__ |`43 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_43_tif.zip>`__ |`44 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_44_tif.zip>`__ |`45 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_45_tif.zip>`__ |`46 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_46_tif.zip>`__ |`47 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_47_tif.zip>`__ |`48 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_48_tif.zip>`__ |`49 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_49_tif.zip>`__ |`410 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_410_tif.zip>`__ |`411 <http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_411_tif.zip>`__ |
+--+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+

Table 1: Table of WorldClim tile grid of global precipitation data

1.1.5 Average Annual Reference Evapotranspiration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Global annual reference evapotranspiration may be obtained from the
CGIAR CSI dataset (based on WorldClim data):
http://www.cgiar-csi.org/data/global-aridity-and-pet-database (Zomer et
al., 2007). The Annual Global-PET dataset is provided for non-commercial
use in standard ARC/INFO Grid format, at 30 arc seconds (~ 1km at
equator), to support studies contributing to sustainable development,
biodiversity and environmental conservation, poverty alleviation, and
adaption to climate change globally, and in particular in developing
countries.

|image03|

Figure 0.3: Screenshot of DropBox folder for global potential
evapotranspiration and aridity index data

|image04|

Figure 0.4: Map of global potential evapotranspiration data

*
*

1.1.6 Plant Available Water Content and Root Restricting Layer Depth
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Depth to root restricting layer can be derived from The FAO global soil
data in their Harmonized World Soil Database (HWSD):
http://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HTML/HWSD_Data.html
(FAO/IIASA/ISRIC/ISSCAS/JRC, 2012). The HWSD is a 30 arc-second raster
database with over 16000 different soil mapping units that combines
existing regional and national updates of soil information worldwide
(SOTER, ESD, Soil Map of China, WISE) with the information contained
within the 1:5’000’000 scale FAO-UNESCO Soil Map of the World.

|image05|

Figure 0.5: Screenshot of Harmonized World Soil Database download page


1.1.7 Land Use Land Cover
~~~~~~~~~~~~~~~~~~~~~~~~~

Land use: Global land use data for 2009 is available at 300m resolution
from: the European Space Agency:
http://due.esrin.esa.int/page_globcover.php (Arino et al., 2012).
GlobCover is an ESA initiative that began in 2005 in partnership with
JRC, EEA, FAO, UNEP, GOFC-GOLD and IGBP. The aim of the project was to
develop a service capable of delivering global composites and land cover
maps using as input observations from the 300m MERIS sensor on board the
ENVISAT satellite mission.

|image06|

Figure 0.6: Map of GlobCover global landuse and land cover data

|image07|

Figure 0.7: Screenshot of GlobCover global landuse and land cover
download page

1.1.8 Watersheds
~~~~~~~~~~~~~~~~

Watersheds and subwatersheds: http://hydrosheds.org/page/hydrobasins
(Lehner & Grill, 2013). HydroBASINS is a series of polygon layers that
depict watershed boundaries and sub-basin delineations at a global
scale. The goal of this product is to provide a seamless global coverage
of consistently sized and hierarchically nested sub-basins at different
scales (from tens to millions of square kilometers), supported by a
coding scheme that allows for analysis of watershed topology such as up-
and downstream connectivity. The HydroBASINS product has been developed
on behalf of World Wildlife Fund US (WWF), with support and in
collaboration with the EU BioFresh project, Berlin, Germany; the
International Union for Conservation of Nature (IUCN), Cambridge, UK;
and McGill University, Montreal, Canada.

|image08|

Figure 0.8: Screenshot of HydroSHEDS global watershed data


1.1.9 Biophysical Table
~~~~~~~~~~~~~~~~~~~~~~~

*For data sources and estimation methods
see*\ http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/reservoirhydropowerproduction.html#appendix-a-data-sources\ *.*

*The following resources are suggested:*

*Schenk, H. J., & Jackson, R. B. (2002). Rooting depths, lateral root
spreads and below-ground/above-ground allometries of plants in
water-limited ecosystems. Journal of Ecology, 90(3),
480–494.*\ `doi:10.1046/j.1365-2745.2002.00682.x <https://doi.org/10.1046/j.1365-2745.2002.00682.x>`__

*Allen, R.G., Pereira, L.S., Raes, D. and Smith, M., 1998. “Crop
evapotranspiration. Guidelines for computing crop water requirements.”
FAO Irrigation and Drainage Paper 56. Food and Agriculture Organization
of the United Nations, Rome, Italy. Available
at:*\ http://www.fao.org/docrep/x0490e/x0490e00.htm

1.1.10 Z Parameter
~~~~~~~~~~~~~~~~~~

*For methods on calculation and estimation
see*\ http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/reservoirhydropowerproduction.html#appendix-a-data-sources\ *for
more information.*

*************************
1.2 Preprocessing in QGIS
*************************

These instructions will help you to prepare each of the inputs for the
InVEST Water Yield model. See module 6.2 for information on obtaining
the necessary data.

1.2.1 Install QGIS
~~~~~~~~~~~~~~~~~~

1. Download the latest version of QGIS from http://qgis.org/ and install
   it. This tutorial was made for QGIS 3.2.3 Bonn with GRASS 7.4.1.

2. Run QGIS

3. When you first open QGIS, you will see the QGIS Tips! Window, click
   **OK** to close it.

|image09|

Figure 0.9: Screenshot of QGIS welcome screen

1.2.2 Change QGIS Language (optional)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Use **Settings >** **Options** to change the language. Under
   **General** check the box next to **Override system locale** and
   change **Locale to use instead** to your preferred language. Click
   **OK** to save the change and restart QGIS to view it in the new
   language.

   |image10|

   Figure 0.10: Screenshot of QGIS general settings for language
   override

.. _area-of-interest-1:

1.2.3 Area of Interest
~~~~~~~~~~~~~~~~~~~~~~

The area of interest (AOI) is the place of your analysis and having it
in the ESRI Shapefile format can be useful during preprocessing to
reduce the data to only that which you will actually use. There are
several ways to get an area of interest polygon for your analysis. If
your analysis area is an official administrative unit it may be possible
to obtain a Shapefile directly from the authorities responsible for this
area. In other cases, you may have to create the Shapefile yourself
using the coordinates for the area. For hydrological analysis it is
ideal if the area of interest corresponds to watersheds or subwatersheds
since these are the units at which a hydrologic process typically
occurs.

Note: Consider creating an initial area of interest with the following
instructions, which you can then use to help select the final area of
interest based on the watersheds as detailed in the section
**Watersheds**.

1. Create a text file with the polygon defined in the WKT format. See
   the example file aoi.txt. The coordinates are a closed list, meaning
   the first and last point are the same. It is conventional to list the
   points in clockwise order.

2. Use **Layer > Add Layer > Add Delimited Text Layer** to create a
   layer from aoi.txt. Click **Add** and then **Close**.

Note: If you are using latitude and longitude the correct projection is
typically EPSG:4326.

|image11|

Figure 0.11: Screenshot of QGIS delimited text data source
manager dialog box for area of interest

3. The area of interest is now listed in the **Layers** panel. Right
   click it and use **Export > Save Features As** to save it to the ESRI
   Shapefile format with the options below.

|image12|

Figure 0.12: Screenshot of QGIS layers panel save vector layer dialog
box for area of interest Shapefile

   Note: See **Projections** in the appendix for more information.

.. _precipitation-1:

1.2.4 Precipitation
~~~~~~~~~~~~~~~~~~~

The precipitation comes from WorldClim dataset.

1. Use **Layer > Add Layer > Add Vector Layer** to add all 12
   precipitation rasters to QGIS.

2. Use **Raster > Raster Calculator** to create wc.tif by adding
   together all 12 precipitation rasters using the **+** operator.

|image13|

Figure 0.13: Screenshot of QGIS raster calculator dialog box
for annual precipitation

3. Use **Raster > Extraction > Clip Raster by Mask Layer** to create
   wc_aoi.tif by clipping wc.tif with aoi.shp.

|image14|

Figure 0.14: Screenshot of QGIS clip raster by mask layer dialog box for
area of interest annual precipitation

4. Use **Raster > Projections > Warp (Reproject)** to create precip.tif
   by projecting wc_aoi.tif to the analysis projection EPSG:32632.

|image15|

Figure 0.15: Screenshot of QGIS warp raster dialog box for reprojected
area of interest annual precipitation


.. _average-annual-reference-evapotranspiration-1:

1.2.5 Average Annual Reference Evapotranspiration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The average annual reference evapotranspiration comes from the CGIAR CSI
dataset.

1. Use **Raster > Extraction > Clip Raster by Mask Layer** to create
   pet_he_yr_aoi.tif by clipping pet_he_yr/w001001.adf with aoi.shp.

|image16|

Figure 0.16: Screenshot of QGIS clip raster by mask layer dialog box for
area of interest average annual reference evapotranspiration

2. Use **Raster > Projections > Warp (Reproject)** to create eto.tif by
   projecting pet_he_yr_aoi.tif.

|image17|

Figure 0.17: Screenshot of QGIS warp raster dialog box for reprojected
area of interest average annual evapotranspiration


.. _plant-available-water-content-and-root-restricting-layer-depth-1:

1.2.6 Plant Available Water Content and Root Restricting Layer Depth
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The plant available water content and root restricting layer depth come
from the Harmonized World Soil Database.

1. Use **Raster > Conversion > Translate** to create soil.tif by
   converting hwsd.bil with the options below. QGIS may not recognize
   the projection so it is important to specify EPSG:4326 in the
   **Override the projection for the output file** parameter.

|image18|

Figure 0.18: Screenshot of QGIS raster format conversion dialog box for
plant available water content and root restricting layer depth

2. Use **Raster > Extraction > Clip Raster by Mask Layer** to create
   soil_aoi.tif by clipping soil.tif with aoi.shp. Be sure to specify
   the **Output data type** as Byte.

|image19|

Figure 0.19: Screenshot of QGIS clip raster by mask layer dialog box for
area of interest plant available water content and root restricting
layer depth

3. Use **Raster > Projections > Warp (Reproject)** to create
   soil_aoi_32632.tif by projecting soil_aoi.tif to the analysis
   projection EPSG:32632.

|image20|

Figure 0.20: Screenshot of QGIS warp raster dialog box for reprojected
area of interest plant available water content and root restricting
layer depth

4. Use **Processing > Toolbox > GRASS > Raster > Raster (r.*) >
   r.reclass** to create pawc.tif by reclassify soil_aoi_32632.tif with
   the provided reclass rules pawc.txt.

|image21|

Figure 0.21: Screenshot of QGIS raster reclass dialog box for
reprojected area of interest plant available water content

Note: The reclass rules in pawc.txt and roots.txt are global and come
from the metadata for the Harmonized World Soil Database. This allows
the conversion of the soil mapping unit (MU_GLOBAL) values in hwsd.bil
to corresponding characteristics. In pawc.txt the available water
content (AWC_CLASS) is divided by the reference soil depth (REF_DEPTH)
for the plant available water content fraction. In roots.txt the range
values for the obstacles to roots depth (ROOTS) categories are averaged
and converted to millimeters for the depth to root resistance.

5. Use **Processing > Toolbox > GRASS > Raster > Raster (r.*) >
   r.reclass** to create depth_to_root_rest_layer.tif by reclassify
   soil_aoi_32632.tif with the provided reclass rules roots.txt.

|image22|

Figure 0.22: Screenshot of QGIS raster reclass dialog box for
reprojected area of interest root restricting layer depth

.. _land-use-land-cover-1:

1.2.7 Land Use Land Cover
~~~~~~~~~~~~~~~~~~~~~~~~~

The land use land cover comes from the GlobCover dataset.

2. Use **Raster > Extraction > Clip Raster by Mask Layer** to create
   gc_aoi.shp by clipping the GLOBCOVER_L4_200901_200912_V2.3.tif with
   aoi.shp.

|image23|

   Figure 0.23: Screenshot of QGIS clip raster by mask layer dialog box
   for area of interest landuse and land cover

3. Use **Raster > Projections > Warp (Reproject)** to create lulc.tif by
   projecting globcover_aoi.tif to the analysis projection of
   EPSG:32632.

|image24|

Figure 0.24: Screenshot of QGIS warp raster dialog box for reprojected
area of interest landuse and land cover

.. _watersheds-1:

1.2.8 Watersheds
~~~~~~~~~~~~~~~~

The watersheds come from the HyrdoBASIN dataset.

1. Use **Layer > Add Layer > Add Vector Layer** to add aoi.shp and the
   watershed layer.

2. Use **Vector > Research Tools > Select by Location** to select the
   watersheds that are within the area of interest.

Note: Depending on the extent of the analysis you may wish to set
**Where the features (geometric predicate)** to another value, but be
aware that if and where the watersheds go beyond the boundaries of the
other clipped and projected datasets some results will be incorrect.

|image25|

Figure 0.25: Screenshot of QGIS select by location dialog box
for area of interest watersheds

3. Right click on the watershed layer and use **Export > Save Features
   As** to save the selected features to the analysis projection of
   EPSG:32632.

|image26|

Figure 0.26: Screenshot of QGIS layers panel save vector
layer dialog box for area of interest watersheds

4. Use **Layer > Add Layer > Add Vector Layer** to add the new
   watersheds.shp with the selected watersheds.

5. Right click on the watersheds.shp layer and select **Open Attribute
   Table.**

6. Use the **Open field calculator** abacus icon to open the **Field
   Calculator.**

7. Use the **Field Calculator** to create a new field named ws_id with
   the value @row_number.

Note: The **Output field length** is the maximum number of digits that
can appear in the field. For example, if you had 10 watersheds you need
a field length of 2 because there are 2 digits in the number 10.

|image27|

Figure 0.27: Screenshot of QGIS field calculator dialog box
for watershed identifiers

8. Now the attribute table should show a new column named **ws_id** with
   row numbers in it. Click on the **Toggle editing mode** pencil icon
   to stop editing and save edits.

9. Use **Vector > Geoprocessing Tools > Dissolve** to create an updated
   aoi.shp from watersheds.shp.

|image28|

Figure 0.28: Screenshot of QGIS dissolve vector layer dialog box for
watersheds area


.. _biophysical-table-1:

1.2.9 Biophysical Table
~~~~~~~~~~~~~~~~~~~~~~~

The biophysical table can be created in a variety of ways, but it can be
useful to first generate a template from the count of the pixel values.

1. Use **Processing > Toolbox > GRASS > Raster (r.*) > r.stats** to
   create the HTML report counts.html with the exact options as below.
   Be sure to specify lulc.tif in the **Name of input raster map**
   parameter.

|image29|

   Figure 0.29: Screenshot of QGIS raster statistics dialog box for
   reprojected area of interest landuse and land cover pixel counts

2. Use **Layer > Add Layer > Add Delimited Text Layer** to create a
   table by removing the HTML formatting by specifying the **Regular
   expression delimiter** as <[^>]+>

|image30|

Figure 0.30: Screenshot of QGIS delimited text data source dialog box for reprojected
area of interest landuse and land cover pixel count table

3. Right click on the table and use **Export > Save Features As** to
   create counts.csv with the current formatting.

|image31|

Figure 0.31: Screenshot of QGIS save vector layer dialog box for comma
separated values of reprojected area of interest landuse and land cover
pixel count table

4. Use **Layer > Add Layer > Add Delimited Text Layer** to remove the
   last undesired formatting elements from counts.csv.

|image32|

Figure 0.32: Screenshot of QGIS delimited text data source manager
dialog box for comma separated values of reprojected area of interest
landuse and land cover pixel count table

5. Right click on the table and use **Export > Save Features As** to
   create biophsyical.csv with the current formatting.

|image33|

Figure 0.33: Screenshot of QGIS save vector layer dialog box for comma
separated values of reprojected area of interest landuse and land cover
pixel count table

Use biophysical.csv as a template and fill in the correct data with the
methods highlighted in Appendix 1.

.. _z-parameter-1:

1.2.10 Z parameter
~~~~~~~~~~~~~~~~~~

See Appendix 1 for more information about the Z parameter.


1.2.11 Reclass Rules for Rasters
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In this document we use Processing > Toolbox > GRASS > Raster > Raster
(r.*) > r.reclass to reclass rasters.

Note: complete documentation on the reclass function can be found at
https://grass.osgeo.org/grass74/manuals/r.reclass.html

The reclass rules text uses the following format, which can either be
specified in a text file or manually using the following format:

10 = 1

12 13 = 2

14 thru 20 = 3

\* = NULL

|image34|

Figure 0.34: Screenshot of QGIS raster reclass dialog box with inline
reclass rules

1.2.12 Adding Fields to a Shapefile
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Use **Layer > Add Layer > Add Vector Layer** to open the shapefile
   that you want to which you want to add a field.

2. Right click and select **Open Attribute Table**.

3. Click on the **Toggle editing mode** pencil icon to enable editing.

4. Click on the **New field** table icon to add a new field.

5. Manually enter the values for the new field or use the calculator to
   calculate them.

Note: The **Open field calculator** abacus icon can create new fields
directly.

|image35|

Figure 0.35: Screenshot of QGIS field calculator dialog box

1.2.13 Projections
~~~~~~~~~~~~~~~~~~

Geography is literally the study of Earth and a projection, or
coordinate system, describes how to divide the Earth into pieces so that
places can be located. Coordinate systems include a formal description
of the shape of Earth, the area where the coordinate system can be used,
and the unit of measure. The unit of measure is either angular or
linear. Angular units are those like degrees that measure parts of a
rotation. Linear units are those like meters that measure distances.

There are thousands of commonly used coordinate systems each with their
own advantages. All coordinates have a coordinate system that must be
specified. Projecting data means to change the coordinate system,
although it should be noted that informally “projected data” is
sometimes used to refer to data with a coordinate system that uses
linear units.

For convenience, QGIS will display together data with different
coordinate systems. However, different datasets must be in the same
coordinate system when they interact as is the case when clipping. For
this reason, it is useful to know how to identify the coordinate system
of data and project data into another coordinate system.

1. Start by first adding the shapefile for your analysis area to QGIS.
   See **Create Area of Interest** above for details. After you add your
   shapefile to QGIS you will see it listed in the **Layers** panel on
   the left.

..

   Note: If you cannot see the layers panel you can enable it by
   selecting **View > Panels > Layers**.

2. Right click on your layer and select **Properties**. Under the
   **Information** tab you will see a section named **Information from
   provider** with an entry **CRS**, which is an abbreviation for
   Coordinate Reference System, and where the coordinate system is
   identified. In the example analysis area you will see **EPSG:4326 -
   WGS 84 – Geographic**. Close the information before continuing to the
   next step.

3. Use **Vector > Data Management Tools > Reproject Layer** to project
   your data to the corresponding UTM zone. For the example analysis
   area set the **Target CRS** to EPSG:4326 as this is the corresponding
   UTM zone.

Note: ESPG:4326 is a global projection, which we use in this document
for the initial steps of processing global layers. However, the example
analysis area falls within EPSG:32632, one of 60 UTM zones defined for
specific locations on Earth, and it is EPSG:32632 that will be used for
analysis. The correct UTM zone for your chosen analysis area may be
different. For detailed information about specific projections see
http://spatialreference.org/

******************
1.3 Running InVEST
******************

*******************************
1.4 Visualizing Results in QGIS
*******************************

1. Download the latest version of QGIS from http://qgis.org/ and install
   it. This tutorial was made for QGIS 2.16.1 Nodebo.

2. Run QGIS

3. When you first open QGIS, you will see the QGIS Tips! Window, click
   **OK** to close it.

|image36|

Figure 0.36: Screenshot of QGIS welcome screen

4. If desired you can change the language of QGIS by selecting
   **Options** from the **Settings** menu. Under **Locale** check the
   box next to **Override system locale** and change **Locale to use
   instead** to your preferred language. Click **OK** to save the change
   and restart QGIS to view it in the new language.

|image37|

Figure 0.37: Screenshot of QGIS general settings for language override

5. Select **Layer > Add Layer > Add Vector Layer** and browse to the
   output from the InVEST Water Yield model and select
   **watershed_results_wyield.shp**. The watersheds will appear in a
   random color. In the Layers Panel right click on the layer and select
   properties. Under the **Style** tab there is the symbology hierarchy
   with **Fill > Simple fill.** Select **Simple fill** in the symbology
   hierarchy and under **Symbol layer type** you will see the symbology
   definition. Next to the current fill color click on the down arrow
   and select **Transparent fill** from about the color wheel. Next
   change the **Outline width** to **0.5 mm**.

|image38|

Figure 0.38 Screenshot of QGIS vector layer properties dialog box for
single symbol style

6. Select **Layer > Add Layer > Add Raster Layer** and browse to the
   output from the InVEST Water Yield model and select **wyield.tif**.
   The water yield will appear in grayscale colors. In the Layers Panel
   right click on the layer and select properties. Under the **Style**
   tab you will see **Render type**. Change **Render type** from
   **Singleband gray** to **Singleband pseudocolor** and change
   **Color** to **Blues**, **Mode** to **Equal interval**, and
   **Classes** to **3**.

|image39|

Figure 0.39: Screenshot of QGIS raster layer properties dialog box for
singleband pseudocolor band rendering

7. Right click **wyield.tif** in the **Layers Panel** and select **Zoom
   to Layer** this will make it easy to set the extent in the Print
   Composer.

8. Open QGIS and select **New Print Composer** from the file menu.

9. Enter **Water Yield** as the title in the Composer title window and
   click **OK**.

|image40|

Figure 0.40: Screenshot of QGIS print composer dialog box for map layout
management

10. Set the desired page properties **Composer > Page Setup** in this
    tutorial we will use **A4** paper.

11. Select **View > Show Grid** and **View > Snap to Grid**

12. Select **Layout > Add Map** use the cross hairs to draw a map area. 
    Click on the **Item properties** tab on the right sided. Under
    **Position and size** set **X** to **10 mm**, **Y** to **10 mm**,
    **Width** to **277 mm**, **Height** to **190 mm**. Under **Extents**
    click on **Set to map canvas extent**. Under **Main properties**
    change **Scale** to a round number that still accommodates the map.

13. Rename the layers in the **Layers Panel** by right click on each
    layer and selecting **Rename**.

14. Select **Layout > Add Legend** and use the cross hairs to draw in a
    legend in the lower right corner. Click on the **Item properties**
    tab on the right sided. Under **Position and size** change the
    **Width** to **35 mm**, **Height** to **45 mm**, **Reference point**
    to the lower right corner, **X** to **287 mm**, and **Y** to **150
    mm\.**

15. Select **Layout > Add Label** use the cross hairs to draw at the
    top. Click on the **Item properties** tab on the right sided. Under
    **Main properties** enter **Water yield in the Tana River Basin**.
    Under **Appearance** change the **Horizontal alignment** to
    **Center** and change **Vertical alignment** to **Middle**. Under
    **Font** change the **Size** to **24.** Under **Position and size**
    set **X** to **10 mm**, **Y** to **10 mm**, **Width** to **277 mm**,
    **Height** to **20 mm**.

16. Select **Layout > Add Label** use the cross hairs to draw in the
    lower left corner. Click on the **Item properties** tab on the right
    sided. Under **Main properties** enter **Data Source: Natural
    Capital Project**. Under **Appearance** leave the **Horizontal
    alignment** at **Left** and change **Vertical alignment** to
    **Bottom**. Under **Font** change the **Size** to **12.** Under
    **Position and size** set **X** to **10 mm**, **Y** to **200 mm**,
    **Width** to **75 mm**, **Height** to **10 mm,** and **Reference
    point** to the lower left corner.

17. Select **Layout > Add Label** use the cross hairs to draw in the
    lower left corner. Click on the **Item properties** tab on the right
    sided. Under **Main properties** enter **Created by [Your Name]**.
    Under **Appearance** leave the **Horizontal alignment** at **Right**
    and change **Vertical alignment** to **Bottom**. Under **Font**
    change the **Size** to **12.** Under **Position and size** set **X**
    to **287 mm**, **Y** to **200 mm**, **Width** to **75 mm**,
    **Height** to **10 mm,** and **Reference point** to the lower right
    corner.

18. Select **Layout > Add Scalebar** use the cross hairs to draw in the
    bottom right. Click on the **Item properties** tab on the right
    sided. Under **Segments** change **Segments** to **left 0** *and*
    **right 6**, select **Fixed width** and set the value to **5000
    units**. Under **Position and size** set **X** to **148.5 mm**,
    **Y** to **200 mm**, **Width** to **100 mm**, **Height** to **20
    mm,** and **Reference point** to the middle center corner.

19. Select **Layout > Add Image** use the cross hairs to draw in the
    lower left corner. Click on the **Item properties** tab on the right
    sided. Under **Search directories** select the desired north arrow
    image from the provided ones. Under **Position and size** set **X**
    to **210 mm**, **Y** to **150 mm**, **Width** to **15 mm**,
    **Height** to **25 mm,** and leave the **Reference point** to as the
    top left.

20. Now that you know how to make a basic map for water yield try making
    maps of the other outputs from InVEST.

|image41|

Figure 0.41: Map of example InVEST water yield model

.. |image01| image:: media/image01.png
   :width: 5.60163in
   :height: 3.20358in
.. |image02| image:: media/image02.png
   :width: 5.37008in
   :height: 3.79134in
.. |image03| image:: media/image03.png
   :width: 6.12094in
   :height: 2.72238in
.. |image04| image:: media/image04.png
   :width: 6.29584in
   :height: 2.68688in
.. |image05| image:: media/image05.png
   :width: 6.29584in
   :height: 2.63611in
.. |image06| image:: media/image06.png
   :width: 5.48783in
   :height: 2.52064in
.. |image07| image:: media/image07.png
   :width: 6.5in
   :height: 3.08333in
.. |image08| image:: media/image08.png
   :width: 6.29444in
   :height: 5.83958in
.. |image09| image:: media/image09.png
   :width: 4.77559in
   :height: 3.20113in
.. |image10| image:: media/image10.png
   :width: 6.29583in
   :height: 5.65694in
.. |image11| image:: media/image11.png
   :width: 6.29583in
   :height: 4.30694in
.. |image12| image:: media/image12.png
   :width: 3.98958in
   :height: 4.41667in
.. |image13| image:: media/image13.png
   :width: 6.29583in
   :height: 5.01319in
.. |image14| image:: media/image14.png
   :width: 4.44792in
   :height: 5.91666in
.. |image15| image:: media/image15.png
   :width: 4.44792in
   :height: 6.44792in
.. |image16| image:: media/image16.png
   :width: 4.44792in
   :height: 5.92708in
.. |image17| image:: media/image17.png
   :width: 4.44792in
   :height: 6.41666in
.. |image18| image:: media/image18.png
   :width: 4.44792in
   :height: 5.23958in
.. |image19| image:: media/image19.png
   :width: 4.44792in
   :height: 7.89584in
.. |image20| image:: media/image20.png
   :width: 4.44792in
   :height: 6.38542in
.. |image21| image:: media/image21.png
   :width: 4.19792in
   :height: 4.44792in
.. |image22| image:: media/image22.png
   :width: 4.19792in
   :height: 4.41667in
.. |image23| image:: media/image23.png
   :width: 4.44792in
   :height: 7.92708in
.. |image24| image:: media/image24.png
   :width: 5.20834in
   :height: 9.33333in
.. |image25| image:: media/image25.png
   :width: 4.19792in
   :height: 4.60417in
.. |image26| image:: media/image26.png
   :width: 3.48958in
   :height: 4.41667in
.. |image27| image:: media/image27.png
   :width: 6.29583in
   :height: 4.82292in
.. |image28| image:: media/image28.png
   :width: 4.44792in
   :height: 3.54167in
.. |image29| image:: media/image29.png
   :width: 4.19792in
   :height: 7.95834in
.. |image30| image:: media/image30.png
   :width: 6.29583in
   :height: 5.46944in
.. |image31| image:: media/image31.png
   :width: 3.48958in
   :height: 6.80208in
.. |image32| image:: media/image32.png
   :width: 6.29584in
   :height: 5.32222in
.. |image33| image:: media/image33.png
   :width: 3.48958in
   :height: 6.75in
.. |image34| image:: media/image34.png
   :width: 3.0724in
   :height: 5.64157in
.. |image35| image:: media/image35.png
   :width: 5.22709in
   :height: 4.78935in
.. |image36| image:: media/image36.png
   :width: 5.71875in
   :height: 3.83333in
.. |image37| image:: media/image37.png
   :width: 5.90556in
   :height: 5.06875in
.. |image38| image:: media/image38.png
   :width: 5.90556in
   :height: 3.98333in
.. |image39| image:: media/image39.png
   :width: 5.90556in
   :height: 5.62986in
.. |image40| image:: media/image40.png
   :width: 2.16667in
   :height: 1.375in
.. |image41| image:: media/image41.png
   :width: 5.90556in
   :height: 4.18542in
